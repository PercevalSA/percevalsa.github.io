<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Run a X11 app in a devcontainer on wayland only distro - cyber stuff & half-working projects</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://percevalsa.github.iofavicon.png><link rel=canonical href=https://percevalsa.github.io/posts/devcontainer-x11-wayland/><link rel=stylesheet href=/css/style.min.46f28338320bb2be67d9306169b35cbc1f6c81477c9089ac6b89bc6ff283ffb7.css><link rel=stylesheet href=/assets/css/extended.min.9729f28a5087b689b946e103d96abd63bfd37b1417effa251dbf798312e3fba5.css><meta name=description content="I run fedora which is a wayland only distro. I need to run a X11 app in a devcontainer."><meta property="og:title" content="Run a X11 app in a devcontainer on wayland only distro"><meta property="og:type" content="website"><meta property="og:url" content="https://percevalsa.github.io/posts/devcontainer-x11-wayland/"><meta property="og:image" content="https://avatars.githubusercontent.com/u/14821372?v=4"><meta property="og:description" content="I run fedora which is a wayland only distro. I need to run a X11 app in a devcontainer."><meta name=twitter:card content="summary"><script data-collect-dnt=true async src=https://scripts.simpleanalyticscdn.com/latest.js></script></head><body class='page frame page-blog-single'><div id=menu-main-mobile class=menu-main-mobile><ul class=menu><li class=menu-item-home><a href=https://percevalsa.github.io/>Home</a></li><li class=menu-item-blog><a href=https://percevalsa.github.io/posts/>Blog</a></li></ul></div><div id=wrapper class=wrapper><div class=header><a class=header-logo href=/>cyber stuff & half-working projects</a><div class=menu-main><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="menu-item-blog active"><a href=/posts/><span>Blog</span></a></li></ul></div><div id=toggle-menu-main-mobile class=hamburger-trigger><button class=hamburger>Menu</button></div></div><div class=blog><div class=intro><h1>Run a X11 app in a devcontainer on wayland only distro<span class=dot>.</span></h1><img alt="Article hero image" src="https://avatars.githubusercontent.com/u/14821372?v=4"></div><div class=content><h1 id=introduction>Introduction</h1><p>I&rsquo;m running fedora after running Ubuntu for a long time. For a project I need to run a X11 application in a devcontainer.
This devcontainer needs an access to the <code>Xauthority</code> file in order to display items on the screen.
On ubuntu, and <code>.Xauthority</code> file is automatically created by the gnome session in the home folder of the user.
But on fedora, the <code>.Xauthority</code> file is created in <code>/run/user/1000/</code> and not in the home folder.
This is a problem because the devcontainer is not able to access this file.</p><p>My mount configuration in the devcontainer settings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;mounts&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;source=${localEnv:HOME}${localEnv:USERPROFILE}/.ssh,target=/home/vscode/.ssh,type=bind,readonly,consistency=cached&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;source=${localEnv:HOME}/.Xauthority,target=/home/vscode/.Xauthority,type=bind,readonly,consistency=cached&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;source=/tmp/.X11-unix,target=/tmp/.X11-unix,type=bind,consistency=cached&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;source=/dev/,target=/dev/,type=bind,consistency=consistent&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span><span class=err>,</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;runArgs&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;--privileged&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;--env&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;DISPLAY&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span><span class=err>,</span>
</span></span></code></pre></div><blockquote class=note><p>ℹ️ <strong><code>HOME</code> vs <code>USERPROFILE</code></strong><br>I&rsquo;m working with people using windows computers. The dual notation <code>USERPROFILE</code> and <code>HOME</code> allows the mount to work on both Windows and Linux hosts.</p></blockquote><h1 id=solution>Solution</h1><p>Create a systemd service that will create the <code>.Xauthority</code> file in the home folder of the user. So the devcontainer can access it. It will be a symlink to the file created by the gnome session.</p><p><code>/etc/systemd/user/xauthority.service</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Create Xauthority to forward screen in devcontainers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>oneshot</span>
</span></span><span class=line><span class=cl><span class=c1>#User=perceval</span>
</span></span><span class=line><span class=cl><span class=c1>#Group=perceval</span>
</span></span><span class=line><span class=cl><span class=na>WorkingDirectory</span><span class=o>=</span><span class=s>/home/perceval/</span>
</span></span><span class=line><span class=cl><span class=na>ExecStartPre</span><span class=o>=</span><span class=s>/usr/bin/rm -rf /home/perceval/.Xauthority</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/bash -c &#34;while [ ! -e /run/user/1000/.mutter-Xwaylandauth.* ]; do sleep 1; done; ln -s /run/user/1000/.mutter-Xwaylandauth.* .Xauthority&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>graphical-session.target</span>
</span></span></code></pre></div><h2 id=comments>Comments</h2><p>To give feedback, send an email to percevalsa [at] outlook dot com.</p></div></div><div class=footer><div class=footer-social><span class="social-icon social-icon-github"><a href=https://github.com/percevalsa title=github target=_blank rel=noopener><img src=/images/social/github.svg width=24 height=24 alt=github></a></span>
<span class="social-icon social-icon-linkedin"><a href=https://www.linkedin.com/in/perceval-arenou/ title=linkedin target=_blank rel=noopener><img src=/images/social/linkedin.svg width=24 height=24 alt=linkedin></a></span></div></div></div><script type=text/javascript src=/js/bundle.min.5993fcb11c07dea925a3fbd58c03c7f1857197c35fccce3aa963a12c0b3c9960.js></script></body></html>