<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Yocto build on external SSD in devcontainers - cyberstuff and halfworking projects</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://percevalsa.github.iofavicon.png><link rel=canonical href=https://percevalsa.github.io/posts/yocto-cache-ssd/><link rel=stylesheet href=/css/style.min.46f28338320bb2be67d9306169b35cbc1f6c81477c9089ac6b89bc6ff283ffb7.css><link rel=stylesheet href=/assets/css/extended.min.9729f28a5087b689b946e103d96abd63bfd37b1417effa251dbf798312e3fba5.css><meta name=description content="How to build a yocto distro in a devcontainer with all files stored on an external SSD"><meta property="og:title" content="Yocto build on external SSD in devcontainers"><meta property="og:type" content="website"><meta property="og:url" content="https://percevalsa.github.io/posts/yocto-cache-ssd/"><meta property="og:image" content="https://www.linuxfoundation.org/hs-fs/hubfs/yocto%20(1).png"><meta property="og:description" content="How to build a yocto distro in a devcontainer with all files stored on an external SSD"><meta name=twitter:card content="summary"><meta name=twitter:site content="PercevalSA"><meta name=twitter:creator content="PercevalSA"></head><body class='page frame page-blog-single'><div id=menu-main-mobile class=menu-main-mobile><ul class=menu><li class=menu-item-home><a href=https://percevalsa.github.io/>Home</a></li><li class=menu-item-blog><a href=https://percevalsa.github.io/posts/>Blog</a></li></ul></div><div id=wrapper class=wrapper><div class=header><a class=header-logo href=/>cyberstuff and halfworking projects</a><div class=menu-main><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="menu-item-blog active"><a href=/posts/><span>Blog</span></a></li></ul></div><div id=toggle-menu-main-mobile class=hamburger-trigger><button class=hamburger>Menu</button></div></div><div class=blog><div class=intro><h1>Yocto build on external SSD in devcontainers<span class=dot>.</span></h1><img alt="Article hero image" src=https://www.linuxfoundation.org/hs-fs/hubfs/yocto%20%281%29.png></div><div class=content><p>I manage and build multiple yocto distributions at work. The <a href=https://wiki.yoctoproject.org/wiki/Build_Performance>performances guidelines</a> advise to use another disk than the one the system is running on. As I have a laptop I only have one internal SSD. Therefore I need to use an external SSD to store my yocto files (downloads in <code>DL_DIR</code> , build in <code>TMPDIR</code> and cache in <code>SSTATE_DIR</code>).
It is a good idea to do so for three reasons :</p><ul><li>First, the cache is enormous and storing it on another disk will spare a lot of needed space (moreover if your SSD is full your system takes more time to boot :s);</li><li>Second, as the files are regularly written, it extends my internal SSD lifespan;</li><li>Third and last it improves overall system performances as you are not writing to your main disk which do not slow downs other I/O of your running OS.</li></ul><p>for the context I using <a href=https://code.visualstudio.com/>VSCode</a> on Ubuntu latest LTS. I build my distros in a devcontainer.
We need to access the external SSD in the devcontainer.</p><p>We could directly mount the external disk in the devcontainer. For that we would add a <code>mount</code> instruction in the configuration file but it couldn&rsquo;t start the devcontainer if the SSD is not plugged in. Because the devcontainer would try to mount a missing folder.</p><p>To avoid that issue I decided to mount the <code>media</code> folder in the dev container. It allows to access all external storage from the devcontainer and does not prevent to open the project if nothing is plugged in or mounted.</p><p>On Ubuntu the external storage are mounted in <code>/media/&lt;user_name>/&lt;device_name></code> where <code>user_name</code> is the current user.
If you work with other people on the project, note that the username of the host will change. Therefore you cannot have a generic definition for your different paths configuration for <code>DL_DIR</code>, <code>TMPDIR</code> and <code>SSTATE_DIR</code> in your <code>local.conf</code></p><p>We can have a generic solution by directly mounting <code>/media/&lt;username></code> from host to <code>/media</code> in devcontainer thanks to the <code>$HOST-USER</code> variable available for devcontainer configuration. The only caveat is that all developers need to use the same name for their external SSD storing yocto builds. It can be only the name of the partition. In my case I decided that the partition or the disk would need to be called <code>yocto</code>. As a result I will have an external SSD mounted automatically on my host Ubuntu as <code>/media/perceval/yocto</code> and then mounted as <code>/media/vscode/yocto</code> in my devcontainer (<code>vscode</code> is the name of the default user in a devcontainer).</p><p>Here is the corresponding line in my <code>.devcontainer</code> file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;mounts&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;source=/media/$HOST-USER/,target=/media/$USER/,type=bind,consistency=cached&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><h2 id=comments>Comments</h2><p>To give feedback, send an email to percevalsa [at] outlook dot com.</p></div></div><div class=footer><div class=footer-social><span class="social-icon social-icon-github"><a href=https://github.com/percevalsa title=github target=_blank rel=noopener><img src=/images/social/github.svg width=24 height=24 alt=github></a></span>
<span class="social-icon social-icon-linkedin"><a href=https://www.linkedin.com/in/perceval-arenou/ title=linkedin target=_blank rel=noopener><img src=/images/social/linkedin.svg width=24 height=24 alt=linkedin></a></span></div></div></div><script type=text/javascript src=/js/bundle.min.5993fcb11c07dea925a3fbd58c03c7f1857197c35fccce3aa963a12c0b3c9960.js></script></body></html>