<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Auto switch between light and dark mode on GNOME - cyber stuff & half-working projects</title>
<meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://percevalsa.github.io/favicon.png><link rel=canonical href=https://percevalsa.github.io/posts/gnome-auto-dark-mode/><link rel=stylesheet href=/css/style.min.46f28338320bb2be67d9306169b35cbc1f6c81477c9089ac6b89bc6ff283ffb7.css><link rel=stylesheet href=/assets/css/extended.min.9729f28a5087b689b946e103d96abd63bfd37b1417effa251dbf798312e3fba5.css><meta name=description content="Auto switch between light and dark mode on GNOME based on night mode configuration using systemd service and timer."><meta property="og:title" content="Auto switch between light and dark mode on GNOME"><meta property="og:type" content="website"><meta property="og:url" content="https://percevalsa.github.io/posts/gnome-auto-dark-mode/"><meta property="og:image" content="https://i0.wp.com/www.omgubuntu.co.uk/wp-content/uploads/2021/10/dark-mode.jpg"><meta property="og:description" content="Auto switch between light and dark mode on GNOME based on night mode configuration using systemd service and timer."><meta name=twitter:card content="summary"></head><body class='page frame page-blog-single'><div id=menu-main-mobile class=menu-main-mobile><ul class=menu><li class=menu-item-home><a href=https://percevalsa.github.io/>Home</a></li><li class=menu-item-blog><a href=https://percevalsa.github.io/posts/>Blog</a></li></ul></div><div id=wrapper class=wrapper><div class=header><a class=header-logo href=/>cyber stuff & half-working projects</a><div class=menu-main><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="menu-item-blog active"><a href=/posts/><span>Blog</span></a></li></ul></div><div id=toggle-menu-main-mobile class=hamburger-trigger><button class=hamburger>Menu</button></div></div><div class=blog><div class=intro><h1>Auto switch between light and dark mode on GNOME<span class=dot>.</span></h1><img alt="Article hero image" src=https://i0.wp.com/www.omgubuntu.co.uk/wp-content/uploads/2021/10/dark-mode.jpg></div><div class=content><p>I want my Fedora 42 (works with 41 I guess) to automatically switch to dark mode at night and light mode during the day. I&rsquo;m already using the night mode to trigger the blue light filter at specific times.</p><p>Thanks to Adam I had a base to start with. He wrote a blog post on having the dark mode auto switch with hard coded times. <a href=https://www.technowizardry.net/2024/06/auto-switch-between-light-and-dark-mode-on-gnome/>You can read it here</a></p><p>This part of the code is what troubled me the most,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>currenttime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%H:%M<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$currenttime<span style=color:#e6db74>&#34;</span> &gt; <span style=color:#e6db74>&#34;17:00&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;</span>$currenttime<span style=color:#e6db74>&#34;</span> &lt; <span style=color:#e6db74>&#34;09:00&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    set_theme dark
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    set_theme light
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>To get the night mode times I used <code>gsettings</code> tool. <a href=https://askubuntu.com/questions/1088650/gnome-night-light-setting-from-the-command-line>source</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gsettings get org.gnome.settings-daemon.plugins.color night-light-schedule-from
</span></span><span style=display:flex><span>gsettings get org.gnome.settings-daemon.plugins.color night-light-schedule-to
</span></span></code></pre></div><p>But the output is in decimal time format (e.g., 20.3 for 20:18). We need to convert the current time in HH:MM format to decimal format (and not the oher way around to avoid float errors). Here is a piece of code that does this conversion:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># convert from HH:MM format (20:18) to decimal format (20.3)</span>
</span></span><span style=display:flex><span>time_to_decimal<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local time_format<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! $time_format <span style=color:#f92672>=</span>~ ^<span style=color:#f92672>[</span>0-9<span style=color:#f92672>]{</span>1,2<span style=color:#f92672>}</span>:<span style=color:#f92672>[</span>0-9<span style=color:#f92672>]{</span>2<span style=color:#f92672>}</span>$ <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Error: Invalid format. Use HH:MM (ex: 20:18)&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># split hours and minutes</span>
</span></span><span style=display:flex><span>    local hours<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$time_format<span style=color:#e6db74>&#34;</span> | cut -d<span style=color:#e6db74>&#39;:&#39;</span> -f1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    local minutes<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$time_format<span style=color:#e6db74>&#34;</span> | cut -d<span style=color:#e6db74>&#39;:&#39;</span> -f2<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># convert minutes in fraction </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 18 minutes = 18/60 = 0.3 hour</span>
</span></span><span style=display:flex><span>    local decimal_part<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;scale=1; </span>$minutes<span style=color:#e6db74> * 10 / 60&#34;</span> | bc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$hours<span style=color:#e6db74>.</span>$decimal_part<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>And the full result is</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>set_theme<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;dark&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        new_gtk_theme<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;prefer-dark&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;light&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        new_gtk_theme<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;prefer-light&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[!] Unsupported theme: </span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    export DBUS_SESSION_BUS_ADDRESS<span style=color:#f92672>=</span>$DBUS_SESSION_BUS_ADDRESS
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$DBUS_SESSION_BUS_ADDRESS<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    current_gtk_theme<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>gsettings get org.gnome.desktop.interface color-scheme<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># echo &#34;[.] Currently using ${current_gtk_theme}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>current_gtk_theme<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#39;</span><span style=color:#e6db74>${</span>new_gtk_theme<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[i] Already using gtk &#39;</span><span style=color:#e6db74>${</span>new_gtk_theme<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; theme&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[-] Setting gtk theme to </span><span style=color:#e6db74>${</span>new_gtk_theme<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        gsettings set org.gnome.desktop.interface color-scheme <span style=color:#e6db74>${</span>new_gtk_theme<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[âœ“] gtk theme changed to </span><span style=color:#e6db74>${</span>new_gtk_theme<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># convert from HH:MM format (20:18) to decimal format (20.3)</span>
</span></span><span style=display:flex><span>time_to_decimal<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local time_format<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! $time_format <span style=color:#f92672>=</span>~ ^<span style=color:#f92672>[</span>0-9<span style=color:#f92672>]{</span>1,2<span style=color:#f92672>}</span>:<span style=color:#f92672>[</span>0-9<span style=color:#f92672>]{</span>2<span style=color:#f92672>}</span>$ <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Error: Invalid format. Use HH:MM (ex: 20:18)&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># split hours and minutes</span>
</span></span><span style=display:flex><span>    local hours<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$time_format<span style=color:#e6db74>&#34;</span> | cut -d<span style=color:#e6db74>&#39;:&#39;</span> -f1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    local minutes<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$time_format<span style=color:#e6db74>&#34;</span> | cut -d<span style=color:#e6db74>&#39;:&#39;</span> -f2<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># convert minutes in fraction </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 18 minutes = 18/60 = 0.3 hour</span>
</span></span><span style=display:flex><span>    local decimal_part<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;scale=1; </span>$minutes<span style=color:#e6db74> * 10 / 60&#34;</span> | bc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$hours<span style=color:#e6db74>.</span>$decimal_part<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># If script run without argument</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -z <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    currenttime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>time_to_decimal <span style=color:#66d9ef>$(</span>date +%H:%M<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>    starttime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>gsettings get org.gnome.settings-daemon.plugins.color night-light-schedule-from<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    endtime<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>gsettings get org.gnome.settings-daemon.plugins.color night-light-schedule-to<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$currenttime<span style=color:#e6db74>&#34;</span> &gt; <span style=color:#e6db74>&#34;</span>$starttime<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#e6db74>&#34;</span>$currenttime<span style=color:#e6db74>&#34;</span> &lt; <span style=color:#e6db74>&#34;</span>$endtime<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        set_theme dark
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        set_theme light
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    set_theme $1
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>Once the script is ready I wanted to modify the timer to avoid hardcoded times. My timer will run every hour but you can increase the frequency if you want. <a href=https://unix.stackexchange.com/questions/704109/configure-systemd-timer-to-run-every-hour-after-first-run>source</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[Unit]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Description</span><span style=color:#f92672>=</span><span style=color:#e6db74>Auto adjusts GNOME theme between dark and light to match the time</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Timer]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>OnBootSec</span><span style=color:#f92672>=</span><span style=color:#e6db74>1min</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>OnUnitActiveSec</span><span style=color:#f92672>=</span><span style=color:#e6db74>1h</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Install]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>WantedBy</span><span style=color:#f92672>=</span><span style=color:#e6db74>timers.target</span>
</span></span></code></pre></div><h1 id=sources>Sources</h1><p>Credits to <a href=https://www.technowizardry.net/2024/06/auto-switch-between-light-and-dark-mode-on-gnome/>Technowizardry</a> for the initial idea and code.</p><p>EDIT: there is a GNOME extension that does this automatically: <a href=https://extensions.gnome.org/extension/2236/night-theme-switcher/>Night Theme Switcher</a>. I didn&rsquo;t know about it when I wrote this post.</p><h2 id=comments>Comments</h2><p>To give feedback, send an email to percevalsa [at] outlook dot com.</p></div></div><div class=footer><div class=footer-social><span class="social-icon social-icon-github"><a href=https://github.com/percevalsa title=github target=_blank rel=noopener><img src=/images/social/github.svg width=24 height=24 alt=github>
</a></span><span class="social-icon social-icon-linkedin"><a href=https://www.linkedin.com/in/perceval-arenou/ title=linkedin target=_blank rel=noopener><img src=/images/social/linkedin.svg width=24 height=24 alt=linkedin></a></span></div></div></div><script type=text/javascript src=/js/bundle.min.5993fcb11c07dea925a3fbd58c03c7f1857197c35fccce3aa963a12c0b3c9960.js></script><script data-collect-dnt=true async src=https://scripts.simpleanalyticscdn.com/latest.js></script></body></html>