<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Auto switch between light and dark mode on GNOME - cyber stuff & half-working projects</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://percevalsa.github.iofavicon.png><link rel=canonical href=https://percevalsa.github.io/posts/gnome-auto-dark-mode/><link rel=stylesheet href=/css/style.min.46f28338320bb2be67d9306169b35cbc1f6c81477c9089ac6b89bc6ff283ffb7.css><link rel=stylesheet href=/assets/css/extended.min.9729f28a5087b689b946e103d96abd63bfd37b1417effa251dbf798312e3fba5.css><meta name=description content="Auto switch between light and dark mode on GNOME based on night mode configuration using systemd service and timer."><meta property="og:title" content="Auto switch between light and dark mode on GNOME"><meta property="og:type" content="website"><meta property="og:url" content="https://percevalsa.github.io/posts/gnome-auto-dark-mode/"><meta property="og:image" content="https://i0.wp.com/www.omgubuntu.co.uk/wp-content/uploads/2021/10/dark-mode.jpg"><meta property="og:description" content="Auto switch between light and dark mode on GNOME based on night mode configuration using systemd service and timer."><meta name=twitter:card content="summary"></head><body class='page frame page-blog-single'><div id=menu-main-mobile class=menu-main-mobile><ul class=menu><li class=menu-item-home><a href=https://percevalsa.github.io/>Home</a></li><li class=menu-item-blog><a href=https://percevalsa.github.io/posts/>Blog</a></li></ul></div><div id=wrapper class=wrapper><div class=header><a class=header-logo href=/>cyber stuff & half-working projects</a><div class=menu-main><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="menu-item-blog active"><a href=/posts/><span>Blog</span></a></li></ul></div><div id=toggle-menu-main-mobile class=hamburger-trigger><button class=hamburger>Menu</button></div></div><div class=blog><div class=intro><h1>Auto switch between light and dark mode on GNOME<span class=dot>.</span></h1><img alt="Article hero image" src=https://i0.wp.com/www.omgubuntu.co.uk/wp-content/uploads/2021/10/dark-mode.jpg></div><div class=content><p>I want my Fedora 42 (works with 41 I guess) to automatically switch to dark mode at night and light mode during the day. I&rsquo;m already using the night mode to trigger the blue light filter at specific times.</p><p>Thanks to Adam I had a base to start with. He wrote a blog post on having the dark mode auto switch with hard coded times. <a href=https://www.technowizardry.net/2024/06/auto-switch-between-light-and-dark-mode-on-gnome/>You can read it here</a></p><p>This part of the code is what troubled me the most,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>currenttime</span><span class=o>=</span><span class=k>$(</span>date +%H:%M<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$currenttime</span><span class=s2>&#34;</span> &gt; <span class=s2>&#34;17:00&#34;</span> <span class=o>||</span> <span class=s2>&#34;</span><span class=nv>$currenttime</span><span class=s2>&#34;</span> &lt; <span class=s2>&#34;09:00&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    set_theme dark
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    set_theme light
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><p>To get the night mode times I used <code>gsettings</code> tool. <a href=https://askubuntu.com/questions/1088650/gnome-night-light-setting-from-the-command-line>source</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gsettings get org.gnome.settings-daemon.plugins.color night-light-schedule-from
</span></span><span class=line><span class=cl>gsettings get org.gnome.settings-daemon.plugins.color night-light-schedule-to
</span></span></code></pre></div><p>But the output is in decimal time format (e.g., 20.3 for 20:18). We need to convert the current time in HH:MM format to decimal format (and not the oher way around to avoid float errors). Here is a piece of code that does this conversion:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># convert from HH:MM format (20:18) to decimal format (20.3)</span>
</span></span><span class=line><span class=cl>time_to_decimal<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>time_format</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> ! <span class=nv>$time_format</span> <span class=o>=</span>~ ^<span class=o>[</span>0-9<span class=o>]{</span>1,2<span class=o>}</span>:<span class=o>[</span>0-9<span class=o>]{</span>2<span class=o>}</span>$ <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Error: Invalid format. Use HH:MM (ex: 20:18)&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># split hours and minutes</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>hours</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$time_format</span><span class=s2>&#34;</span> <span class=p>|</span> cut -d<span class=s1>&#39;:&#39;</span> -f1<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>minutes</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$time_format</span><span class=s2>&#34;</span> <span class=p>|</span> cut -d<span class=s1>&#39;:&#39;</span> -f2<span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># convert minutes in fraction </span>
</span></span><span class=line><span class=cl>    <span class=c1># 18 minutes = 18/60 = 0.3 hour</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>decimal_part</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;scale=1; </span><span class=nv>$minutes</span><span class=s2> * 10 / 60&#34;</span> <span class=p>|</span> bc<span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$hours</span><span class=s2>.</span><span class=nv>$decimal_part</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>And the full result is</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>set_theme<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;dark&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>new_gtk_theme</span><span class=o>=</span><span class=s2>&#34;prefer-dark&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;light&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nv>new_gtk_theme</span><span class=o>=</span><span class=s2>&#34;prefer-light&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;[!] Unsupported theme: </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>DBUS_SESSION_BUS_ADDRESS</span><span class=o>=</span><span class=nv>$DBUS_SESSION_BUS_ADDRESS</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$DBUS_SESSION_BUS_ADDRESS</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>current_gtk_theme</span><span class=o>=</span><span class=k>$(</span>gsettings get org.gnome.desktop.interface color-scheme<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># echo &#34;[.] Currently using ${current_gtk_theme}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>current_gtk_theme</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;&#39;</span><span class=si>${</span><span class=nv>new_gtk_theme</span><span class=si>}</span><span class=s2>&#39;&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;[i] Already using gtk &#39;</span><span class=si>${</span><span class=nv>new_gtk_theme</span><span class=si>}</span><span class=s2>&#39; theme&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;[-] Setting gtk theme to </span><span class=si>${</span><span class=nv>new_gtk_theme</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        gsettings <span class=nb>set</span> org.gnome.desktop.interface color-scheme <span class=si>${</span><span class=nv>new_gtk_theme</span><span class=si>}</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;[✓] gtk theme changed to </span><span class=si>${</span><span class=nv>new_gtk_theme</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># convert from HH:MM format (20:18) to decimal format (20.3)</span>
</span></span><span class=line><span class=cl>time_to_decimal<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>time_format</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> ! <span class=nv>$time_format</span> <span class=o>=</span>~ ^<span class=o>[</span>0-9<span class=o>]{</span>1,2<span class=o>}</span>:<span class=o>[</span>0-9<span class=o>]{</span>2<span class=o>}</span>$ <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;Error: Invalid format. Use HH:MM (ex: 20:18)&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># split hours and minutes</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>hours</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$time_format</span><span class=s2>&#34;</span> <span class=p>|</span> cut -d<span class=s1>&#39;:&#39;</span> -f1<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>minutes</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$time_format</span><span class=s2>&#34;</span> <span class=p>|</span> cut -d<span class=s1>&#39;:&#39;</span> -f2<span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># convert minutes in fraction </span>
</span></span><span class=line><span class=cl>    <span class=c1># 18 minutes = 18/60 = 0.3 hour</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>decimal_part</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;scale=1; </span><span class=nv>$minutes</span><span class=s2> * 10 / 60&#34;</span> <span class=p>|</span> bc<span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$hours</span><span class=s2>.</span><span class=nv>$decimal_part</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># If script run without argument</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> -z <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nv>currenttime</span><span class=o>=</span><span class=k>$(</span>time_to_decimal <span class=k>$(</span>date +%H:%M<span class=k>))</span>
</span></span><span class=line><span class=cl>    <span class=nv>starttime</span><span class=o>=</span><span class=k>$(</span>gsettings get org.gnome.settings-daemon.plugins.color night-light-schedule-from<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>endtime</span><span class=o>=</span><span class=k>$(</span>gsettings get org.gnome.settings-daemon.plugins.color night-light-schedule-to<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$currenttime</span><span class=s2>&#34;</span> &gt; <span class=s2>&#34;</span><span class=nv>$starttime</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> <span class=s2>&#34;</span><span class=nv>$currenttime</span><span class=s2>&#34;</span> &lt; <span class=s2>&#34;</span><span class=nv>$endtime</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        set_theme dark
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        set_theme light
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    set_theme <span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><p>Once the script is ready I wanted to modify the timer to avoid hardcoded times. My timer will run every hour but you can increase the frequency if you want. <a href=https://unix.stackexchange.com/questions/704109/configure-systemd-timer-to-run-every-hour-after-first-run>source</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Auto adjusts GNOME theme between dark and light to match the time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Timer]</span>
</span></span><span class=line><span class=cl><span class=na>OnBootSec</span><span class=o>=</span><span class=s>1min</span>
</span></span><span class=line><span class=cl><span class=na>OnUnitActiveSec</span><span class=o>=</span><span class=s>1h</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>timers.target</span>
</span></span></code></pre></div><h1 id=sources>Sources</h1><p>Credits to <a href=https://www.technowizardry.net/2024/06/auto-switch-between-light-and-dark-mode-on-gnome/>Technowizardry</a> for the initial idea and code.</p><p>EDIT: there is a GNOME extension that does this automatically: <a href=https://extensions.gnome.org/extension/2236/night-theme-switcher/>Night Theme Switcher</a>. I didn&rsquo;t know about it when I wrote this post.</p><h2 id=comments>Comments</h2><p>To give feedback, send an email to percevalsa [at] outlook dot com.</p></div></div><div class=footer><div class=footer-social><span class="social-icon social-icon-github"><a href=https://github.com/percevalsa title=github target=_blank rel=noopener><img src=/images/social/github.svg width=24 height=24 alt=github></a></span>
<span class="social-icon social-icon-linkedin"><a href=https://www.linkedin.com/in/perceval-arenou/ title=linkedin target=_blank rel=noopener><img src=/images/social/linkedin.svg width=24 height=24 alt=linkedin></a></span></div></div></div><script type=text/javascript src=/js/bundle.min.5993fcb11c07dea925a3fbd58c03c7f1857197c35fccce3aa963a12c0b3c9960.js></script></body></html>